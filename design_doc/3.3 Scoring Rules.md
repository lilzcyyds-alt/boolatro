# 3.3 Scoring Rules（计分规则）

> 目标：定义 Boolatro 的计分模型（Chips × Mult），以及“完整证明 / 未证明成功”两种情况下的结算方式。
>
> 本文是 **规则层设计**，不绑定具体实现代码；搭档牌（Partner）效果后续在对应文档补全。

---

## 1) 核心公式（Chips × Mult）

### 1.1 完整证明得分

```text
完整证明分数 = (基础分数 + 证明行奖励 + 搭档牌效果) × 倍数
```

- **基础分数**：来自玩家本次提交使用的基础卡牌（卡面 Chips）
- **证明行奖励**：来自本次证明 **最后使用的 inference rule**（结论行）所提供的 (Chips, Mult)
- **搭档牌效果**：Partner/Joker 类的加成（本阶段先占位，不在本文实现）
- **倍数**：默认为 1，在规则/搭档等加成后形成最终 Mult

### 1.2 未证明成功（未完成证明 / 无效证明）

若玩家未证明出来（例如提交无效、或未达到“结论成立”的条件）：

```text
未证明分数 = (基础分数 + 搭档牌效果) × 倍数
```

约束：
- 此时 **不计入证明行奖励**（inference rule 的 Chips/Mult 奖励不生效）
- **倍数默认为 1**（若搭档牌未来允许提供倍数加成，则在那时再纳入）

---

## 2) 组成定义

### 2.1 基础分数

```text
基础分数 = 基础卡片分数 × 卡牌数量
```

说明：
- **基础卡片分数**：当前基础卡牌（或本次用于计分的卡牌）的单卡 Chips 值。
- **卡牌数量**：本次提交所计入的卡牌数量。

> 注：当前实现阶段可以先用固定值（例如单卡 Chips = 10）或从卡牌数据结构读取。

### 2.2 证明行奖励（Inference Rule Reward）

- 只由 **最后所使用的 inference rule（结论行）** 决定奖励。
- 每个 rule 提供两类奖励：
  - `ruleChips`: 给 Chips 的加成（加到括号内部）
  - `ruleMult`: 给 Mult 的加成（加到倍数项里）

示例（占位示意，最终以表格为准）：
- `&ELIM`：`+30 Chips`，`+2 Mult`

---

## 3) 计算流程（推荐顺序）

1. 计算 `base = 基础卡片分数 × 卡牌数量`
2. 判定本次提交是否为 **完整证明**（valid proof + 结论一致）
3. 若完整证明：
   - 取 `ruleChips`, `ruleMult`（由结论行 rule 决定）
   - `chips = base + ruleChips + partnerChips`
   - `mult = 1 + ruleMult + partnerMult`
4. 若未证明成功：
   - `chips = base + partnerChips`
   - `mult = 1 + partnerMult`（允许未来搭档牌在失败时也加 mult；当前实现阶段可为 0）
5. `score = chips × mult`

---

## 4) Rule Reward Table（待补全）

> 本表将成为实现的单一事实来源（Single Source of Truth）。

| Inference Rule | ruleChips | ruleMult | Notes |
|---|---:|---:|---|
| reit | TBD | TBD | |
| &elim | 30 | 2 | 示例值（来自需求描述） |
| &intro | TBD | TBD | |
| ~elim | TBD | TBD | |
| ~intro | TBD | TBD | |

---

## 5) Worked Examples（示例）

### 5.1 完整证明（示例）

设：
- 单卡基础 Chips = 10
- 卡牌数量 = 3
- 结论行 rule = `&ELIM`（+30 Chips, +2 Mult）
- 搭档牌效果暂忽略（0）

则：
- 基础分数 = 10 × 3 = 30
- Chips = 30 + 30 = 60
- Mult = 1 + 2 = 3
- 最终分数 = 60 × 3 = 180

### 5.2 未证明成功（示例）

同样的基础卡牌：
- 基础分数 = 10 × 3 = 30
- 未证明成功 → 不计入 rule 奖励
- Chips = 30
- Mult = 1
- 最终分数 = 30 × 1 = 30

---

## 6) Clarifications（已确认）

根据当前决定：

1. **卡牌数量（cardCount）**：只统计“结论用牌”——也就是玩家在出牌阶段打出的、用于构造结论的牌数。
2. **未证明成功时的倍数**：允许未来的搭档牌系统在失败时也提供 mult（目前搭档牌尚未实现）。因此失败时也使用：
   - `mult = 1 + partnerMult`
3. **中间推理过程**：不参与计分。只看结论行（最后使用的 inference rule）提供的奖励。

> 下一步：补全 Rule Reward Table，并在代码中落地 `chips/mult` 的结算结构与 UI 对接。
