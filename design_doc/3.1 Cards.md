# 3.1 Cards

本文件详细记录了游戏中卡牌的配置方式、字段定义以及已实现的特殊卡牌逻辑。

## 1. 配置字段说明 (Configuration Fields)

卡牌通过 `assets/config/cards.json` 进行配置，每个卡牌对象包含以下字段：

- **`id`**: 唯一标识符。该 ID 必须与代码中对应的 `Effect` 类或逻辑标识符匹配，用于引擎识别卡牌功能。
- **`name`**: 卡牌名称。在商店界面和玩家物品栏中显示的文本。
- **`content`**: (可选) 逻辑内容。对于 `atomic` 或 `connective` 类型的卡牌，该字段定义了其代表的逻辑符号（如 "P", "&", "~" 等）。系统会根据此字段随机匹配变体图片。
- **`imagePath`**: 资源路径。指向卡牌对应的图片资源（例如 `assets/images/card_sprites/p/pfriday.png`）。如果图片加载成功，UI 将隐藏文本显示；否则将回退到文本显示。
- **`description`**: 描述。详细说明卡牌的具体效果或背景信息，展示在 UI 的描述面板中。
- **`category`**: 卡牌类别。用于逻辑分类或 UI 分组，常见的类别包括：
  - `atomic`: 原子卡，代表逻辑变量（如 P, Q 等），通常没有特殊能力（Ability）。
  - `partner`: 搭档卡，通常在正确证明时提供加成。
  - `alchemy`: 炼金术卡，可能在特定条件（如无效证明）下触发。
- **`cost`**: 购买成本。玩家在商店购买该卡牌所需消耗的金钱数量。

---

## 2. 特殊卡牌列表 (Special Cards List)

以下是当前版本已实现的特殊卡牌及其逻辑：

### 1. Partner Card (搭档卡)
- **ID (Config)**: `partner_card_1`
- **名称**: "Junior Partner"
- **描述**: "When a valid proof is submitted, add bonus score."
- **触发时机**: `onProofSubmitted`
- **效果逻辑**: 
  - 检查证明是否有效 (`ctx.isValidProof`)。
  - 如果有效，返回一个包含额外分数的 `EffectPatch`。
- **实现文件**: `lib/boolatro/effects/cards/partner_card.dart`

### 2. Alchemy Card (炼金术卡)
- **ID (Config)**: `alchemy_card_1`
- **名称**: "Sublimatio"
- **描述**: "When an invalid proof is submitted, add 3 bonus score."
- **触发时机**: `onProofSubmitted`
- **效果逻辑**:
  - 检查证明是否无效 (`!ctx.isProofValid`)。
  - 如果无效，返回一个包含 `addScore: 3` 的 `EffectPatch`。
- **实现文件**: `lib/boolatro/effects/cards/alchemy_card.dart`
- **注意**: `cards.json` 中的描述需同步更新。原子卡（Atomic Cards）目前主要作为逻辑原子，不包含特殊 Ability。

### 3. Extra Hand Card (额外手牌卡)
- **ID (Config)**: `extra_hand_card_1`
- **名称**: "Billable Hours"
- **描述**: "At the start of each round, gain an extra hand."
- **触发时机**: `onRoundStart`
- **效果逻辑**: 
  - 返回一个包含 `addHands: 1` 的 `EffectPatch`。
- **实现文件**: `lib/boolatro/effects/cards/extra_hand_card.dart`

---

## 3. 如何添加新卡牌 (How to Add New Cards)

1. **编写代码**: 在 `lib/boolatro/effects/cards/` 下创建新的类，继承自 `SpecialCard` 并重写 `onTrigger(EffectContext ctx)` 方法。
2. **注册配置**: 在 `assets/config/cards.json` 中添加该卡牌的 JSON 对象，确保 `id` 与代码逻辑对应。
3. **准备资源**: 确保 `imagePath` 指向的图片已添加到 `pubspec.yaml` 的 assets 中。
4. **验证时机**: 根据 `ctx.trigger` 判断效果触发时机并返回正确的 `EffectPatch`。
