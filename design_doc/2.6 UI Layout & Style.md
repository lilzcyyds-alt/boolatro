# 2.6 UI Layout & Style

## 设计目标

构建一个高度还原 Balatro 风格、以 **16:9** 为基准比例、且深度集成 **Flame Engine** 的游戏化界面。

## 布局架构 (Layout Architecture)

整体布局遵循 **"一切皆为 GameObject"** 的原则，并采用严格的层级管理。

### 1. 分辨率标准与静态锚点
- **基准分辨率**: 锁定为 **1920x1080 px**。
- **静态锚点原则**: `RootLayoutComponent` (Layer 0) 是最外层的静态容器，它在整个游戏生命周期中保持位置 (0, 0) 不变。所有的全局缩放都基于此 1080p 基准。

### 2. 层级架构 (Hierarchy Layers)

| 层级 | 名称 | 职责描述 |
| :--- | :--- | :--- |
| **Layer 0** | **Root Layout** | 静态基准容器，负责全局坐标系对齐。 |
| **Layer 1** | **区域容器 (Section Containers)** | UI 的核心物理分区（如 Joker 栏、计分板、舞台等）。负责自身在 1080p 空间内的飞入/飞出定位。 |
| **Layer 2+** | **GameObject** | 具体的 UI 元素（按钮、卡牌、文字等）。负责区域内部的局部布局和交互逻辑。 |

### 3. 核心区域划分 (Layer 1)

整体画面基于 1920x1080 坐标系进行严格的网格切分。为了保证视觉上的呼吸感，每个区域之间以及与屏幕边缘之间均保留约 **10 px** 的间隙（Gap/Margin）。

```text
+-----------------------------------------------------------------------+
|  [10px Margin]                                                        |
|  +----------+  +---------------------------------------+  +---------+ |
|  | Phase    |  | Region A: Joker Row (Top)             |  | (Action | |
|  | Info     |  | Position: (250, 10)                   |  |  Ext)   | |
|  | (10,10)   |  | Size: (1420, 100)                     |  |         | |
|  +----------+  +---------------------------------------+  +---------+ |
|                                                                       |
|  +----------+  +---------------------------------------+  +---------+ |
|  | (Gap)    |  | Region C: Stage Area (Central)        |  | Region D| |
|  |          |  | Position: (250, 120)                  |  | Action  | |
|  +----------+  | Size: (1420, 750)                     |  | Panel   | |
|  | Region B:|  |                                       |  | (1690,  | |
|  | Scoring  |  | 此处承载:                             |  |  120)   | |
|  | Panel    |  | - Select Blind Stage                  |  +---------+ |
|  | (10, 210)|  | - Proof Stage                         |              |
|  | Size:    |  | - Shop / Cashout Stage                |  [10px Gap]  |
|  | (230,860)|  |                                       |              |
|  |          |  +---------------------------------------+  +---------+ |
|  |          |  | Region E: Player Hand (Bottom)        |  | (Gap)   | |
|  |          |  | Position: (250, 880)                  |  |         | |
|  |          |  | Size: (1420, 190)                     |  |         | |
|  +----------+  +---------------------------------------+  +---------+ |
|  [10px Margin]                                                        |
+-----------------------------------------------------------------------+
```

| 区域 | 名称 | 起始坐标 (X, Y) | 建议尺寸 (W, H) | 功能描述 |
| :--- | :--- | :--- | :--- | :--- |
| **左上** | **阶段信息** | (10, 10) | (230, 100) | 显示当前游戏状态。 |
| **顶部** | **Joker 栏** | (250, 10) | (1420, 100) | 展示特殊卡牌。 |
| **左侧** | **计分面板** | (10, 210) | (230, 860) | 显示分数、目标、金钱、手牌。 |
| **中央** | **舞台区域** | (250, 120) | (1420, 750) | 核心动态容器，承载各阶段逻辑。 |
| **右侧** | **操作面板** | (1690, 120) | (220, 750) | 包含功能按钮。 |
| **底部** | **玩家手牌** | (250, 880) | (1420, 190) | 扇形排列逻辑卡牌。 |

### 4. 计分面板内部布局细节 (Scoring Panel Internal)

为了确保视觉清晰度并防止长数值导致的文字重叠，计分面板内部遵循以下规则：

- **数值右对齐**: 金钱、手牌数、弃牌数等动态数值统一采用 `Anchor.centerRight` 靠右对齐。
- **标签固定位置**: "MONEY"、"HANDS"、"DISCARDS" 等标签固定在区域左侧，与数值之间保留足够的安全间距。
- **垂直间距优化**: 
  - 分数显示区（SCORE Box）整体下移，与顶部的金钱区及底部的状态区保持明确的视觉区隔。
  - 数值与对应的背景装饰（Pill/Box）垂直居中对齐。

## 过渡动画与坐标所有权 (Transitions & Ownership)

### 1. 坐标所有权标准化
- **Root Layout** 拥有对 **区域容器 (Layer 1)** 的位置决定权。所有的飞入/飞出路径点必须由 Root Layout 基于全局 1080p 坐标定义。
- **区域容器** 拥有对 **内部 GameObject (Layer 2+)** 的布局权。GameObject 的坐标应相对于其父容器（局部坐标），而不是全局坐标。

### 2. 过渡规则 (Transition Rules)
- **禁止叠加动画 (No Double-Animation)**: 严禁同时移动父容器和子 GameObject。
  - *正例*: 阶段切换时，`StageComponent` 容器整体向下飞走，内部元素位置保持相对静止。
  - *反例*: `StageComponent` 向下飞的同时，其内部的标题又在向上飞。这会导致全局坐标计算混乱，造成定位漂移。
- **安全屏幕外偏移 (Safe Off-screen Offset)**: 飞出位置必须确保完全超出 1920x1080 的可视区域。
  - *标准*: 垂直方向偏移至少 ±1200 px，水平方向偏移至少 ±2200 px。
- **可见性强制执行**: 所有的飞出动画在 `completed` 后，必须明确设置 `isVisible = false`，以彻底停止渲染并禁用所有交互逻辑。

### 3. 组件复用与缓存
- `StageComponent` 维护一个 `Map<GamePhase, BoolatroComponent>` 的实例缓存。
- 阶段切换通过将旧 Stage 容器移出屏幕，并将新 Stage 容器移入屏幕实现。

## 视觉规范 (Visual Specs)

### 1. 配色方案 (Color Palette)
- **背景**: `Colors.blueGrey.shade900` 到 `Colors.black` 的线性渐变。
- **状态颜色**:
  - **MONEY**: 橙色 (`Colors.orange.shade700`)。
  - **SCORE**: 深红色 (`Colors.red.shade900`)。
  - **HANDS**: 蓝色 (`Colors.blue.shade700`)。

### 2. 特效与交互
- **扇形排列 (Fanned Hand)**: 手牌基于 `Flyable` 混入实现平滑重排，角度计算基于中心索引。
- **GameObject 文字**: 使用 `BoolatroTextComponent` 统一管理文字的过渡动画。
- **混合渲染**: 
  - **Flame Components** 用于核心游戏流程和动态 UI。
  - **Flutter Overlays** 仅用于 `ProofEditor` 等需要原生键盘支持的文本输入场景。
